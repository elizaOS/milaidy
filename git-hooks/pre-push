#!/usr/bin/env bash
#
# Pre-push hook: Prevents direct pushes to the main branch.
# All changes to main must go through a pull request.
#

PROTECTED_BRANCHES=("main")

current_branch=$(git symbolic-ref HEAD 2>/dev/null | sed 's|refs/heads/||')

# Read the push info from stdin
while read local_ref local_sha remote_ref remote_sha; do
  remote_branch=$(echo "$remote_ref" | sed 's|refs/heads/||')

  for protected in "${PROTECTED_BRANCHES[@]}"; do
    if [ "$remote_branch" = "$protected" ]; then
      echo ""
      echo "ðŸš«  Push to '$protected' branch is not allowed."
      echo "    Please create a pull request instead."
      echo ""
      exit 1
    fi
  done
done

exit 0
